import os
import numpy as np

def get_timestamps_map(dir_path, timestamps_file):
    with open(os.path.join(dir_path, timestamps_file), 'r') as f:
        timestamps = f.readlines()
    timestamps = [float(t.strip()) for t in timestamps]
    files = sorted(os.listdir(dir_path))
    images = [f for f in files if f.endswith('.npy') or f.endswith('.png')]
    return dict(zip(timestamps, [os.path.join(dir_path, img) for img in images]))

def match_images(a_dir, b_dir):
    a_map = get_timestamps_map(a_dir, 'timestamps.txt')
    b_map = get_timestamps_map(b_dir, 'timestamps.txt')
    
    for a_t, a_img in a_map.items():
        b_t = min(b_map.keys(), key=lambda t: abs(t - a_t))
        if abs(a_t - b_t) <= 0.1 / 1000:  # 0.1 ms = 0.1 / 1000 s
            process(a_img, b_map[b_t])

def process(img1, img2):
    pass  # 用你的处理函数替换
